<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gmair.drift.excode">
    <resultMap id="excodeVo" type="finley.gmair.model.drift.EXCode">
        <result property="codeId" column="code_id"></result>
        <result property="activityId" column="activity_id"></result>
        <result property="channel" column="channel"></result>
        <result property="codeValue" column="code_value"></result>
        <result property="status" column="code_status"
                typeHandler="finley.gmair.mybatis.handler.EXCodeStatusHandler"></result>
        <result property="price" column="price"></result>
        <result property="blockFlag" column="block_flag"></result>
        <result property="createAt" column="create_time"></result>
    </resultMap>

    <select id="query" parameterType="java.util.Map" resultMap="excodeVo">
        select code_id, activity_id, channel, code_value, code_status, price, block_flag, create_time
        from gmair_drift.drift_excode
        where 1 = 1
        <if test="codeId != null">
            and code_id = #{codeId}
        </if>
        <if test="activityId != null">
            and activity_id = #{activityId}
        </if>
        <if test="channel != null">
            and channel = #{channel}
        </if>
        <if test="codeValue != null">
            and code_value = #{codeValue}
        </if>
        <if test="status != null">
            and code_status = #{status}
        </if>
        <if test="price != null">
            and price = #{price}
        </if>
        <if test="blockFlag != null">
            and block_flag = #{blockFlag}
        </if>
        <if test="search != null">
            and (code_value like #{search})
        </if>
        ORDER BY create_time desc
    </select>

    <insert id="insert" parameterType="finley.gmair.model.drift.EXCode" useGeneratedKeys="false">
        insert into gmair_drift.drift_excode(code_id, activity_id, channel, code_value, code_status, price, block_flag, create_time)
        values(#{codeId}, #{activityId}, #{channel}, #{codeValue}, #{status, typeHandler=org.apache.ibatis.type.EnumOrdinalTypeHandler}, #{price}, #{blockFlag}, #{createAt})
    </insert>

    <update id="update" parameterType="java.util.Map">
        update gmair_drift.drift_excode
        <set>
            <if test="status != null">
                code_status = #{status},
            </if>
            <if test="price != null">
                price = #{price},
            </if>
            <if test="blockFlag != null">
                block_flag = #{blockFlag},
            </if>
        </set>
        where code_id = #{codeId}
    </update>
</mapper>