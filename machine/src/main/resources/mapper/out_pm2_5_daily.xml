<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gmair.machine.outPm25Daily">
    <resultMap id="outPm25Daily" type="finley.gmair.model.machine.OutPm25Daily">
        <result property="recordId" column="record_id"></result>
        <result property="machineId" column="machine_id"></result>
        <result property="averagePm25" column="average_pm25"></result>
        <result property="overCount" column="over_count"></result>
        <result property="blockFlag" column="block_flag"></result>
        <result property="createAt" column="create_time"></result>
    </resultMap>

    <insert id="insert" parameterType="finley.gmair.model.machine.OutPm25Daily" useGeneratedKeys="false">
        INSERT INTO gmair_machine.out_pm2_5_daily(record_id, machine_id, average_pm25, over_count, block_flag, create_time)
        VALUES(#{recordId}, #{machineId}, #{averagePm25}, #{overCount}, #{blockFlag}, #{createAt})
    </insert>

    <select id="query" parameterType="java.util.Map" resultMap="outPm25Daily">
        SELECT record_id,machine_id,average_pm25,over_count,block_flag,create_time
        FROM gmair_machine.out_pm2_5_daily
        WHERE 1 = 1
        <if test="recordId != null">
            AND record_id = #{recordId}
        </if>
        <if test="machineId != null">
            AND machine_id = #{machineId}
        </if>
        <if test="overCountLimit != null">
            AND over_count >= #{overCountLimit}
        </if>
        <if test="createAt != null">
            AND create_time >= #{createAt}
        </if>
        <if test="dateDiff != null">
            <![CDATA[
                AND DATEDIFF(CURDATE(),create_time) = 1
            ]]>
        </if>
        order by create_time desc
    </select>
</mapper>