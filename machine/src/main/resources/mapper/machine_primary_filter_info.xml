<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gmair.machine.machine_primary_filter_info">
    <resultMap id="machine_primary_filter_info" type="finley.gmair.dto.MachinePrimaryFilterInfo">
        <result property="qrcode" column="qr_code"/>
        <result property="needClean" column="is_need_clean"/>
        <result property="remindSwitchOn" column="clean_remind_status"/>
        <result property="isReminded" column="is_reminded"/>
        <result property="lastConfirmTime" column="last_confirm_time"/>
    </resultMap>

    <select id="query" parameterType="java.util.Map" resultMap="machine_primary_filter_info">
        SELECT m.qr_code, m.is_need_clean, m.clean_remind_status, m.is_reminded, m.last_confirm_time
        FROM gmair_machine.machine_filter_clean m, gmair_machine.goods_model g, gmair_machine.qrcode q
        WHERE m.qr_code = q.code_value AND q.model_id = g.model_id
        <if test="qrcode != null">
            AND m.qr_code = #{qrcode}
        </if>
        <if test="machineType != null">
            AND g.model_name = #{machineType}
        </if>
        <if test="blockFlag != null">
            AND m.block_flag = #{blockFlag}
        </if>
        order by m.create_time desc LIMIT #{offset}, #{pageSize}
    </select>

</mapper>