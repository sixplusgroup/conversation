<!DOCTYPE html>
<html lang="zh_CN" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>果麦新风</title>
    <link rel="stylesheet" th:href="@{/monitor/static/layui/css/layui.css}" media="all"/>
    <link rel="stylesheet" th:href="@{/monitor/static/font-awesome-4.7.0/css/font-awesome.min.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/monitor/static/css/multiple_view.css}"/>
    <script type="text/javascript" th:src="@{/monitor/static/limarquee/js/jquery-1.8.3.min.js}"></script>
</head>
<body style="background-color: #f8f8f8">
<div class="layui-carousel" id="test1" style="background-color: #f8f8f8">
    <div class="location-div">
        <div id="time1" class="time1">
        </div>
        <img src="https://monitor.gmair.net/image/location_logo.png" class="location-img"/>
        <img src="https://monitor.gmair.net/image/guomai.png" class="geer-img"/>
        <div class="run_type2" id="online2">
            <img src="https://monitor.gmair.net/image/wind.png" class="wind-img"/>
            <span>果麦新风净化系统运行中</span>
        </div>
        <div style="display: none" class="run_type2" id="offline2">
            <span>果麦新风净化系统离线中</span>
        </div>
    </div>
    <div carousel-item="" id="page_item">
    </div>
    <div class="contact-div">
        <div class="footer_left">
            <img src="https://monitor.gmair.net/image/gmair_logo.png" class="logo-image"/>
            <img src="https://monitor.gmair.net/image/log.png" class="log-image"/>
        </div>
        <div class="footer_content">
            <div><span>TEL&nbsp;:&nbsp;</span>4009946898</div>
            <div><span>Email&nbsp;:&nbsp;</span>service@gmair.net</div>
        </div>
        <div class="footer_right">
            <div class="footer_right_img_div">
                <img src="https://monitor.gmair.net/image/wechat.png" class="qrcode-img"/>
            </div>
            <div class="footer_right_img_div">
                <img src="https://monitor.gmair.net/image/wechat_public.jpg" id="ad-img" class="qrcode-img"/>
            </div>
        </div>
    </div>
</div>
<!-- 条目中可以是任意内容，如：<img src=""> -->
<script th:src="@{/monitor/static/layui/layui.js}"></script>
<script>
    /*<![CDATA[*/

    var consumerId = "";
    var height = window.innerHeight;
    $(document).ready(function () {
        $(".item").css({"height": height * 0.30, "margin-bottom": height * 0.03});
        // $("#time1").show();
        // $(".run_type2").show();
        $("#time1").text(init_time());
        $(".location-div").css("height", height * 0.1);
        consumerId = obtainConsumerId("multiple");
        obtainMonitorData(consumerId);
    })
    setInterval(function () {
        obtainMonitorData(consumerId)
    }, 30000);
    layui.use('carousel', function () {
        var carousel = layui.carousel;
        //建造实例
        carousel.render({
            elem: '#test1',
            width: '100%',//设置容器宽度
            height: height * 0.66,
            indicator: 'none',
            interval: 10000,
            arrow: 'none' //始终显示箭头
            //,anim: 'updown' //切换动画方式
        });
    });

    function init_time() {
        var today = new Date();
        var year = today.getFullYear();
        var month = ('0' + (today.getMonth() + 1)).slice(-2).toString();
        var date = ('0' + today.getDate()).slice(-2).toString();
        var hour = ('0' + today.getHours()).slice(-2).toString();
        var minute = ('0' + today.getMinutes()).slice(-2).toString();
        var date_string = year + "年" + month + "月" + date + "日" + "  " + hour + ":" + minute;
        return date_string;
    }

    function obtainConsumerId(name) {
        var reg = new RegExp('(?:(?:&|\\?)' + name + '=([^&]*))|(?:/' + name + '/([^/]*))', 'i');
        var r = window.location.href.match(reg);
        if (r != null)
            return decodeURI(r[1] || r[2]);
        return null;
        // let path=path_name.split("/");
        // return path[3];
    }

    function setPm25Color(pm2_5) {
        var color = "";
        if (pm2_5 === "") {
            color = "";
        } else if (pm2_5 >= 0 & pm2_5 <= 35) {
            color = "pm2_5_excellent";
        } else if (pm2_5 > 35 && pm2_5 <= 75) {
            color = "pm2_5_moderate";
        } else if (pm2_5 > 75 && pm2_5 <= 115) {
            color = "pm2_5_sensative";
        } else if (pm2_5 > 115 && pm2_5 <= 150) {
            color = "pm2_5_unhealthy";
        } else if (pm2_5 > 150 && pm2_5 <= 250) {
            color = "pm2_5_very_unhealthy";
        } else if (pm2_5 > 250) {
            color = "pm2_5_hazardous";
        }
        return color;
    }

    function setPm25Text(pm2_5) {
        var text = ""
        if (pm2_5 === "") {
            text = "优";
        } else if (pm2_5 >= 0 & pm2_5 <= 35) {
            text = "优";
        } else if (pm2_5 > 35 && pm2_5 <= 75) {
            text = "良";
        } else if (pm2_5 > 75 && pm2_5 <= 115) {
            text = "轻度污染";
        } else if (pm2_5 > 115 && pm2_5 <= 150) {
            text = "中度污染";
        } else if (pm2_5 > 150 && pm2_5 <= 250) {
            text = "重度污染";
        } else if (pm2_5 > 250) {
            text = "严重污染";
        }
        return text;
    }

    function setCO2Useful(co2,i) {
        if(co2===2000){
            $("#co2"+i).hide();
            $("#pm25"+i).attr("class","data_middle")
        }else{
            $("#pm25"+i).attr("class","data_left")
        }
    }

    function setCO2Text(co2) {
        let text = "";
        if (co2 === "") {
            text = "氧气充沛";
        }else if (co2 >=0 && co2 < 1000) {
            text = "氧气充沛";
        } else if (co2 >= 1000 && co2 < 2000) {
            text = "CO₂浓度高";
        } else if (co2 > 2000) {
            text = "CO₂浓度过高";
        }
        return text;
    }

    function obtainMonitorData(consumerId) {
        $.ajax({
            type: 'get',
            url: "https://microservice.gmair.net/monitor/consumer/machine/list/status?consumerId=" + consumerId,
            data: {},
            cache: false,
            processData: false,
            contentType: false,
            success: function (response) {
                setDataItem(response);
            },
            error: function () {
                console.log("请求失败")
            },
        })
    }

    function setDataItem(response) {
        if (response.responseCode == 'RESPONSE_ERROR') {
            return;
        }
        $("#page_item").empty();
        var length = Math.floor((response.data.length - 1) / 8);
        for (var j = 0; j <= length; j++) {
            var $machineTemp = $("<div></div>");
            var data_length;
            if (j === length) {
                data_length = response.data.length;
            } else {
                data_length = j * 8 + 8
            }
            for (var i = j * 8; i < data_length; i++) {
                $machineTemp.append("<div class=\"responsive\">\n" +
                    "                <div class=\"item\">\n" +
                    "                    <div class=\"machine_name\" id='machine_name"+i+"'>" + response.data[i].bindName + "</div>\n" +
                    "                    <div class=\"data_left\" id='pm25"+i+"'>\n" +
                    "                        <div class=\"data_name\">\n" +
                    "                            室内PM2.5\n" +
                    "                        </div>\n" +
                    "                        <div class=\"data_value\" id='pm25_value"+i+"'>" + response.data[i].pm2_5 + "</div>" +
                    "                        <div class='data_evaluate " + setPm25Color(response.data[i].pm2_5) + "' id=\"pm25_evaluate8\">" + setPm25Text(response.data[i].pm2_5) + "</div>" +
                    "                    </div>\n" +
                    "                    <div class=\"data_right\" id='co2"+i+"'>\n" +
                    "                        <div class=\"data_name\">\n" +
                    "                            室内CO₂\n" +
                    "                        </div>\n" +
                    "                        <div class=\"data_value\">" + response.data[i].co2 + "</div>\n" +
                    "                        <div class=\"data_co2_evaluate\" id=\"co2_evaluate8\">" + setCO2Text(response.data[i].co2) + "</div>\n" +
                    "                    </div>\n" +
                    "                    <div class=\"data_bottom\">\n" +
                    "                        <i class=\"fa fa-leaf fa-fw\" aria-hidden=\"true\"></i><span id=\"wind_value8\">" + response.data[i].volume + "</span>\n" +
                    "                        <i class=\"fa fa-thermometer fa-fw\" aria-hidden=\"true\"></i><span id=\"temp8\">" + response.data[i].temp + "℃</span>\n" +
                    "                        <i class=\"fa fa-tint fa-fw\" aria-hidden=\"true\"></i><span id=\"humid8\">" + response.data[i].humid + "%</span>\n" +
                    "                    </div>\n" +
                    "                </div>\n" +
                    "            </div>");

            }
            $machineTemp.appendTo("#page_item");
            for(let i=j*8;i<data_length;i++){
                setCO2Useful(response.data[i].co2,i);
            }

        }

        $(".item").css({"height": height * 0.30, "margin-bottom": height * 0.03});
        $("#page_item").show();
        layui.use('carousel', function () {
            var carousel = layui.carousel;
            //建造实例
            carousel.render({
                elem: '#test1',
                width: '100%',//设置容器宽度
                height: height * 0.66,
                indicator: 'none',
                interval: 10000,
                arrow: 'none' //始终显示箭头
                //,anim: 'updown' //切换动画方式
            });
        });
    }
    /*]]>*/
</script>
</body>
</html>