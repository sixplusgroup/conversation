<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gmair.membership.membership">
    <insert id="insert" parameterType="finley.gmair.model.membership.MembershipConsumer">
        insert into gmair_membership.membership_consumer (consumer_id,first_integral,second_integral,create_time)
        value(#{consumerId},#{firstIntegral},#{secondIntegral},#{createAt})
    </insert>
    <select id="selectOne" resultType="finley.gmair.model.membership.MembershipConsumer">
        select * from gmair_membership.membership_consumer where consumer_id = #{consumerId}
    </select>
    <update id="update" parameterType="java.util.Map">
        update gmair_membership.membership_consumer
        <set>
            <if test="firstIntegral !=null ">
                first_integral = #{firstIntegral},
            </if>
            <if test="secondIntegral !=null ">
                second_integral = #{secondIntegral},
            </if>
        </set>
    </update>
<!--    this is a bug-->
    <update id="setEventScheduler">
        DROP EVENT IF EXISTS `gmair_membership_integral_maintain`;
        CREATE EVENT `gmair_membership_integral_maintain`
            ON SCHEDULE
            EVERY '1' YEAR STARTS '2023-01-03 00:00:00'
            ON COMPLETION PRESERVE
            COMMENT 'integralmaintain'
            DO update gmair_membership.membership_consumer set first_integral = second_integral, second_integral = 0;
    </update>
</mapper>