<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gmair.weather.city">

    <resultMap id="cityweatherconditionfull" type="finley.gmair.model.air.CityWeatherCondition">
        <result column="city_id" property="cityId"></result>
        <result column="wea_condition" property="condition"></result>
        <result column="wea_condition_id" property="conditionId"></result>
        <result column="wea_humidity" property="humidity"></result>
        <result column="wea_pressure" property="pressure"></result>
        <result column="real_feel" property="realFeel"></result>
        <result column="sun_rise" property="sunRise"></result>
        <result column="sun_set" property="sunSet"></result>
        <result column="temp" property="temp"></result>
        <result column="one_tips" property="tips"></result>
        <result column="uvi" property="uvi"></result>
        <result column="vis" property="vis"></result>
        <result column="wind_degress" property="windDegress"></result>
        <result column="wind_dir" property="windDir"></result>
        <result column="wind_level" property="windLevel"></result>
        <result column="wind_speed" property="windSpeed"></result>
        <result column="update_time" property="updateTime"></result>
        <result column="block_flag" property="blockFlag"></result>
        <result column="create_time" property="createAt"></result>
    </resultMap>

    <resultMap id="CityTempVo" type="finley.gmair.vo.air.CityTempVo">
        <result column="city_id" property="cityId"/>
        <result column="temp" property="temp"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <insert id="insertBatch" parameterType="java.util.List">
        INSERT INTO `gmair_airquality`.`city_weather_condition_full`
        (city_id,wea_condition,wea_condition_id,wea_humidity,icon,wea_pressure,real_feel,
        sun_rise,sun_set,temp,one_tips,uvi,vis,wind_degrees,wind_dir,wind_level,
        wind_speed,update_time,block_flag,create_time)
        VALUES
        <foreach collection="list" separator="," index="index" item="weatherCondition">
            (
            #{weatherCondition.cityId},#{weatherCondition.condition},#{weatherCondition.conditionId},
            #{weatherCondition.humidity},#{weatherCondition.icon},#{weatherCondition.pressure},#{weatherCondition.realFeel},
            #{weatherCondition.sunRise},#{weatherCondition.sunSet},#{weatherCondition.temp},#{weatherCondition.tips},
            #{weatherCondition.uvi},#{weatherCondition.vis},#{weatherCondition.windDegrees},
            #{weatherCondition.windDir},#{weatherCondition.windLevel},#{weatherCondition.windSpeed},
            #{weatherCondition.updateTime},#{weatherCondition.blockFlag},#{weatherCondition.createAt}
            )
        </foreach>

    </insert>

    <select id="query" parameterType="java.util.Map" resultMap="CityTempVo">
        select
        city_id, temp, record_time
        FROM `gmair_airquality`.`city_weather_condition_full`
        WHERE 1 = 1
        <if test="cityId != null">
            and city_id = #{cityId}
        </if>
        <if test="updateTime != null">
            AND update_time = #{updateTime}
        </if>
        <if test="updateTimeGT != null">
            AND update_time > #{updateTimeGT}
        </if>
        <if test="updateTimeLT != null">
            <![CDATA[
                AND update_time < #{updateTimeLT}
            ]]>
        </if>
    </select>
</mapper>