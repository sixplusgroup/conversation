<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gmair.install.assign">
    <resultMap id="assignVo" type="finley.gmair.model.installation.Assign">
        <result property="assignId" column="assign_id"></result>
        <result property="codeValue" column="code_value"></result>
        <result property="teamId" column="team_id"></result>
        <result property="memberId" column="member_id"></result>
        <result property="companyId" column="company_id"></result>
        <result property="assignStatus" column="assign_status"
                typeHandler="finley.gmair.mybatis.handler.AssignStatusHandler"></result>
        <result property="consumerConsignee" column="consumer_consignee"></result>
        <result property="consumerPhone" column="consumer_phone"></result>
        <result property="consumerAddress" column="consumer_address"></result>
        <result property="region" column="assign_region"></result>
        <result property="detail" column="assign_detail"></result>
        <result property="assignDate" column="assign_date"></result>
        <result property="source" column="assign_source"></result>
        <result property="description" column="assign_description"></result>
        <result property="type" column="assign_type"></result>
        <result property="blockFlag" column="block_flag"></result>
        <result property="createAt" column="create_time"></result>
    </resultMap>

    <resultMap id="assignMemberVo" type="finley.gmair.model.installation.AssignMember">
        <result property="assignId" column="assign_id"></result>
        <result property="codeValue" column="code_value"></result>
        <result property="teamId" column="team_id"></result>
        <result property="teamName" column="team_name"></result>
        <result property="memberId" column="member_id"></result>
        <result property="memberName" column="member_name"></result>
        <result property="assignStatus" column="assign_status"
                typeHandler="finley.gmair.mybatis.handler.AssignStatusHandler"></result>
        <result property="consumerConsignee" column="consumer_consignee"></result>
        <result property="consumerPhone" column="consumer_phone"></result>
        <result property="consumerAddress" column="consumer_address"></result>
        <result property="region" column="assign_region"></result>
        <result property="detail" column="assign_detail"></result>
        <result property="assignDate" column="assign_date"></result>
        <result property="source" column="assign_source"></result>
        <result property="description" column="assign_description"></result>
        <result property="type" column="assign_type"></result>
        <result property="blockFlag" column="block_flag"></result>
        <result property="createAt" column="create_time"></result>
    </resultMap>

    <select id="query" parameterType="java.util.Map" resultMap="assignVo">
        SELECT
        assign_id,
        code_value,
        team_id,
        member_id,
        company_id,
        assign_status,
        consumer_consignee,
        consumer_phone,
        consumer_address,
        assign_region,
        assign_date,
        assign_detail,
        assign_source,
        assign_description,
        assign_type,
        block_flag,
        create_time
        FROM gmair_install.install_assign
        WHERE 1 = 1
        <if test="assignId != null">
            AND assign_id = #{assignId}
        </if>
        <if test="codeValue != null">
            AND code_value = #{codeValue}
        </if>
        <if test="teamId != null">
            AND team_id = #{teamId}
        </if>
        <if test="companyId != null">
            AND company_id = #{companyId}
        </if>
        <if test="teams != null">
            AND team_id IN
            <foreach item="item" collection="teams" separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="memberId != null">
            AND member_id = #{memberId}
        </if>
        <if test="consumerConsignee != null">
            AND consumer_consignee = #{consumerConsignee}
        </if>
        <if test="consumerPhone != null">
            AND consumer_phone = #{consumer_phone}
        </if>
        <if test="assignStatus != null">
            AND assign_status = #{assignStatus}
        </if>
        <if test="region != null">
            AND assgin_region = #{region}
        </if>
        <if test="source != null">
            AND assign_source = #{source}
        </if>
        <if test="blockFlag != null">
            AND block_flag = #{blockFlag}
        </if>
        <if test="type != null">
            AND assign_type = #{type}
        </if>
        <if test='sortType == "CREATE"'>
            ORDER BY create_time desc
        </if>
        <if test='sortType == "FINISH"'>
            ORDER BY assign_date desc
        </if>
        <!--<if test="page != null and pageLength!= null">-->
            <!--LIMIT page,pageLength-->
        <!--</if>-->
    </select>

    <select id="principal" parameterType="java.util.Map" resultMap="assignMemberVo">
        SELECT
        assign_id,
        code_value,
        team_id,
        team_name,
        member_id,
        member_name,
        assign_status,
        consumer_consignee,
        consumer_phone,
        consumer_address,
        assign_region,
        assign_date,
        assign_detail,
        assign_source,
        assign_description,
        assign_type,
        block_flag,
        create_time
        FROM gmair_install.assign_member_view
        WHERE 1 = 1
        <if test="assignId != null">
            AND assign_id = #{assignId}
        </if>
        <if test="codeValue != null">
        AND code_value = #{codeValue}
        </if>
        <if test="teamId != null">
            AND team_id = #{teamId}
        </if>
        <if test="memberId != null">
            AND member_id = #{memberId}
        </if>
        <if test="teams != null">
            AND team_id IN
            <foreach item="item" collection="teams" separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="phone != null">
            AND consumer_phone LIKE #{phone}
        </if>
        <if test="consumer != null">
            AND (consumer_consignee LIKE #{consumer}
            OR team_name LIKE #{consumer}
            OR member_name LIKE #{consumer})
        </if>
        <if test="assignStatus != null">
            AND assign_status = #{assignStatus}
        </if>
        <if test="type != null">
            AND assign_type = #{type}
        </if>
        <if test="region != null">
            AND assgin_region = #{region}
        </if>
        <if test="source != null">
            AND assign_source = #{source}
        </if>
        <if test="blockFlag != null">
            AND block_flag = #{blockFlag}
        </if>
        <if test='sortType == "CREATE"'>
            ORDER BY create_time desc
        </if>
        <if test='sortType == "FINISH"'>
            ORDER BY assign_date desc
        </if>
        <if test="duration =='lastWeek' ">
            <![CDATA[
                AND DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= DATE(create_time)
			]]>
        </if>
        <if test="duration =='thisMonth' ">
            <![CDATA[
                AND DATE_FORMAT(create_time, '%Y%m')= DATE_FORMAT(CURDATE(), '%Y%m')
			]]>
        </if>
        <if test="duration =='thisYear' ">
            <![CDATA[
                AND YEAR(create_time)=YEAR(NOW())
			]]>
        </if>
        <if test='start != null and length != null'>
            LIMIT #{start},#{length}
        </if>
    </select>

    <select id="principalLength" parameterType="java.util.Map" resultType="java.lang.Integer">
        SELECT count(*)
        FROM gmair_install.assign_member_view
        WHERE 1 = 1
        <if test="assignId != null">
            AND assign_id = #{assignId}
        </if>
        <if test="codeValue != null">
            AND code_value = #{codeValue}
        </if>
        <if test="teamId != null">
            AND team_id = #{teamId}
        </if>
        <if test="memberId != null">
            AND member_id = #{memberId}
        </if>
        <if test="teams != null">
            AND team_id IN
            <foreach item="item" collection="teams" separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="phone != null">
            AND consumer_phone LIKE #{phone}
        </if>
        <if test="type != null">
        AND assign_type = #{type}
    </if>
        <if test="consumer != null">
            AND (consumer_consignee LIKE #{consumer}
            OR team_name LIKE #{consumer}
            OR member_name LIKE #{consumer})
        </if>
        <if test="assignStatus != null">
            AND assign_status = #{assignStatus}
        </if>
        <if test="region != null">
            AND assgin_region = #{region}
        </if>
        <if test="source != null">
            AND assign_source = #{source}
        </if>
        <if test="blockFlag != null">
            AND block_flag = #{blockFlag}
        </if>
        <if test="duration =='lastWeek' ">
            <![CDATA[
                AND DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= DATE(create_time)
			]]>
        </if>
        <if test="duration =='thisMonth' ">
            <![CDATA[
                AND DATE_FORMAT(create_time, '%Y%m')= DATE_FORMAT(CURDATE(), '%Y%m')
			]]>
        </if>
        <if test="duration =='thisYear' ">
            <![CDATA[
                AND YEAR(create_time)=YEAR(NOW())
			]]>
        </if>
    </select>

    <select id="worker" parameterType="java.util.Map" resultMap="assignVo">
        SELECT
        assign_id,
        code_value,
        team_id,
        member_id,
        assign_status,
        consumer_consignee,
        consumer_phone,
        consumer_address,
        assign_date,
        assign_detail,
        block_flag,
        create_time
        FROM gmair_install.assign_member_view
        WHERE 1 = 1
        <if test="memberId != null">
            AND member_id = #{memberId}
        </if>
        <if test="assignStatus != null">
            AND assign_status = #{assignStatus}
        </if>
        <if test="phone != null">
            AND consumer_phone LIKE #{phone}
        </if>
        <if test="consumer != null">
            AND (consumer_consignee LIKE #{consumer}
            OR team_name LIKE #{consumer}
            OR member_name LIKE #{consumer})
        </if>
        <if test="blockFlag != null">
            AND block_flag = #{blockFlag}
        </if>
        <if test='sortType == "CREATE"'>
            ORDER BY create_time desc
        </if>
        <if test='sortType == "FINISH"'>
            ORDER BY assign_date desc
        </if>
    </select>

    <insert id="insert" parameterType="finley.gmair.model.installation.Assign">
        INSERT INTO gmair_install.install_assign (assign_id, code_value, team_id, member_id,company_id, assign_status, consumer_consignee, consumer_phone, consumer_address, assign_region, assign_detail, assign_date, assign_source, assign_description, assign_type, block_flag, create_time)
        VALUES (#{assignId}, #{codeValue}, #{teamId}, #{memberId},#{companyId},
                             #{assignStatus, typeHandler=org.apache.ibatis.type.EnumOrdinalTypeHandler},
                             #{consumerConsignee}, #{consumerPhone}, #{consumerAddress}, #{region}, #{detail},
                             #{assignDate}, #{source}, #{description}, #{type}, #{blockFlag}, #{createAt})
    </insert>

    <update id="update" parameterType="java.util.Map">
        UPDATE gmair_install.install_assign
        <set>
            <if test="codeValue != null">
                code_value = #{codeValue},
            </if>
            <if test="teamId != null">
                team_id = #{teamId},
            </if>
            <if test="memberId != null">
                member_id = #{memberId},
            </if>
            <if test="assignStatus != null">
                assign_status = #{assignStatus},
            </if>
            <if test="assignDate != null">
                assign_date = #{assignDate},
            </if>
            <if test="consumerConsignee != null">
                consumer_consignee = #{consumerConsignee},
            </if>
            <if test="consumerPhone != null">
                consumer_phone = #{consumerPhone},
            </if>
            <if test="consumerAddress != null">
                consumer_address = #{consumerAddress},
            </if>
            <if test="region != null">
                assign_region = #{region},
            </if>
            <if test="description != null">
                assign_description = #{description},
            </if>
            <if test="type != null">
                assign_type = #{type},
            </if>
            <if test="blockFlag != null">
                block_flag = #{blockFlag},
            </if>
            assign_id = #{assignId}
        </set>
        WHERE assign_id = #{assignId}
    </update>

    <update id="block">
        UPDATE gmair_install.install_assign
        SET block_flag = TRUE
        WHERE assign_id = #{assignId}
    </update>

    <delete id="remove">
        DELETE FROM gmair_install.install_assign
        WHERE assign_id = #{assignId}
    </delete>
</mapper>
