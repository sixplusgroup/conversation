<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gmair.install.userassign">
    <resultMap id="userassign" type="finley.gmair.model.installation.Userassign">
        <result property="userassignId" column="userassign_id"></result>
        <result property="consumerConsignee" column="consumer_consignee"></result>
        <result property="consumerPhone" column="consumer_phone"></result>
        <result property="consumerAddress" column="consumer_address"></result>
        <result property="userassignDetail" column="userassign_detail"></result>
        <result property="userassignStatus" column="userassign_status"></result>
        <result property="userassignDate" column="userassign_date"></result>
        <result property="userassignType" column="userassign_type"></result>
        <result property="remarks" column="remarks"></result>
        <result property="createAt" column="create_time"></result>
    </resultMap>
    <insert id="insert" parameterType="finley.gmair.model.installation.Userassign">
        INSERT INTO gmair_install.install_userassign (userassign_id, consumer_consignee, consumer_phone, consumer_address,userassign_detail, userassign_status, userassign_date, userassign_type, remarks, create_time)
        VALUES (#{userassignId}, #{consumerConsignee}, #{consumerPhone}, #{consumerAddress},#{userassignDetail},
                             #{userassignStatus}, #{userassignDate}, #{userassignType}, #{remarks}, #{createAt})
    </insert>


    <select id="query" parameterType="java.util.Map" resultMap="userassign">
        SELECT
        userassign_id,
        consumer_consignee,
        consumer_phone,
        consumer_address,
        userassign_detail,
        userassign_status,
        userassign_date,
        userassign_type,
        remarks,
        create_time
        FROM gmair_install.install_userassign
        WHERE 1 = 1
        <if test="userassignId != null">
            AND userassign_id = #{userassignId}
        </if>
        <if test="consumerConsignee != null">
            AND consumer_consignee = #{consumerConsignee}
        </if>
        <if test="consumerPhone != null">
            AND consumer_phone = #{consumerPhone}
        </if>
        <if test="consumerAddress != null">
            AND consumer_address = #{consumerAddress}
        </if>
        <if test="blockFlag != null">
            AND block_flag = #{blockFlag}
        </if>
        <if test="userassignDetail != null">
            AND userassign_detail = #{userassignDetail}
        </if>
        <if test="userassignStatus != null">
            AND userassign_status = #{userassignStatus}
        </if>
        <if test="userassignDate != null">
            AND userassign_date = #{userassignDate}
        </if>
        <if test="userassignType != null">
            AND userassign_type = #{userassignType}
        </if>

        <if test="createAt != null">
            AND create_time = #{createAt}
        </if>

        <if test='sortType == "CREATE"'>
            ORDER BY create_time desc
        </if>
        <if test='sortType == "FINISH"'>
            ORDER BY userassign_date desc
        </if>
        <!--<if test="page != null and pageLength!= null">-->
        <!--LIMIT page,pageLength-->
        <!--</if>-->
    </select>

    <select id="principal" parameterType="java.util.Map" resultMap="userassign">
        SELECT
        userassign_id,
        consumer_consignee,
        consumer_phone,
        consumer_address,
        userassign_detail,
        userassign_status,
        userassign_date,
        userassign_type,
        remarks,
        create_time
        FROM gmair_install.install_userassign
        WHERE 1 = 1
        <if test="userassignId != null">
            AND userassign_id = #{userassignId}
        </if>
        <if test="blockFlag != null">
            AND block_flag = #{blockFlag}
        </if>
        <if test="consumerConsignee != null">
            AND consumer_consignee like #{consumerConsignee}
        </if>
        <if test="consumerPhone != null">
            AND consumer_phone like #{consumerPhone}

        </if>
        <if test="userassignStatus != null">
            AND userassign_status = #{userassignStatus}
        </if>

        <if test='sortType == "CREATE"'>
            ORDER BY create_time desc
        </if>
        <if test='sortType == "FINISH"'>
            ORDER BY userassign_date desc
        </if>
        <if test="duration =='lastWeek' ">
            <![CDATA[
                AND DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= DATE(create_time)
			]]>
        </if>
        <if test="duration =='thisMonth' ">
            <![CDATA[
                AND DATE_FORMAT(create_time, '%Y%m')= DATE_FORMAT(CURDATE(), '%Y%m')
			]]>
        </if>
        <if test="duration =='thisYear' ">
            <![CDATA[
                AND YEAR(create_time)=YEAR(NOW())
			]]>
        </if>
        <if test='start != null and length != null'>
            LIMIT #{start},#{length}
        </if>
    </select>


    <select id="principalLength" parameterType="java.util.Map" resultType="java.lang.Integer">
        SELECT count(*)
        FROM gmair_install.install_userassign
        WHERE 1 = 1
        <if test="userassignId != null">
            AND userassign_id = #{userassignId}
        </if>
        <if test="blockFlag != null">
            AND block_flag = #{blockFlag}
        </if>
        <if test="consumerConsignee != null">
            AND consumer_consignee like #{consumerConsignee}
        </if>
        <if test="consumerPhone != null">
            AND consumer_phone like #{consumerPhone}

        </if>
        <if test="userassignStatus != null">
            AND userassign_status = #{userassignStatus}
        </if>

        <if test='sortType == "CREATE"'>
            ORDER BY create_time desc
        </if>
        <if test='sortType == "FINISH"'>
            ORDER BY userassign_date desc
        </if>
        <if test="duration =='lastWeek' ">
            <![CDATA[
                AND DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= DATE(create_time)
			]]>
        </if>
        <if test="duration =='thisMonth' ">
            <![CDATA[
                AND DATE_FORMAT(create_time, '%Y%m')= DATE_FORMAT(CURDATE(), '%Y%m')
			]]>
        </if>
        <if test="duration =='thisYear' ">
            <![CDATA[
                AND YEAR(create_time)=YEAR(NOW())
			]]>
        </if>
        <if test='start != null and length != null'>
            LIMIT #{start},#{length}
        </if>
    </select>

    <update id="updateUserassignStatus" parameterType="java.util.Map">
        UPDATE gmair_install.install_userassign
        <set>
            userassign_status = #{status},
            <if test="userassignDate != null">
                userassign_date = #{userassignDate},
            </if>
        </set>

        WHERE userassign_id = #{userassignId}
    </update>

    <update id="update" parameterType="finley.gmair.model.installation.Userassign">
        update gmair_install.install_userassign
        <set>

            <if test="consumerConsignee != null">
                consumer_consignee = #{consumerConsignee},
            </if>
            <if test="consumerPhone != null">
                consumer_phone = #{consumerPhone},
            </if>
            <if test="consumerAddress != null">
                consumer_address = #{consumerAddress},
            </if>

            <if test="userassignDetail != null">
                userassign_detail = #{userassignDetail},
            </if>
            <if test="userassignType != null">
                userassign_type = #{userassignType},
            </if>
            <if test="remarks != null">
                remarks = #{remarks},
            </if>
        </set>
        WHERE userassign_id = #{userassignId}
    </update>
</mapper>
